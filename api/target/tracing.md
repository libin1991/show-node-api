[35m[4m[1m# Trace Events[22m[24m[39m

[90m<!--introduced_in=v7.7.0-->[39m
[90m[39m
[90m[39m[90m[3m    [0mStability: 1 - Experimental[0m[23m[39m

[0mTrace Event provides a mechanism to centralize tracing information generated by[0m
[0mV8, Node.js core, and userspace code.[0m

[0mTracing can be enabled with the [33m--trace-event-categories[39m command-line flag[0m
[0mor by using the [33mtrace_events[39m module. The [33m--trace-event-categories[39m flag[0m
[0maccepts a list of comma-separated category names.[0m

[0mThe available categories are:[0m

    * [0m[33mnode[39m: An empty placeholder.[0m
    * [0m[33mnode.async_hooks[39m: Enables capture of detailed [34m[33masync_hooks[39m[34m ([34m[4masync_hooks.html[24m[39m[34m)[39m trace data.[0m
      [0mThe [34m[33masync_hooks[39m[34m ([34m[4masync_hooks.html[24m[39m[34m)[39m events have a unique [33masyncId[39m and a special [33mtriggerId[39m[0m
      [0m[33mtriggerAsyncId[39m property.[0m
    * [0m[33mnode.bootstrap[39m: Enables capture of Node.js bootstrap milestones.[0m
    * [0m[33mnode.console[39m: Enables capture of [33mconsole.time()[39m and [33mconsole.count()[39m[0m
      [0moutput.[0m
    * [0m[33mnode.dns.native[39m: Enables capture of trace data for DNS queries.[0m
    * [0m[33mnode.environment[39m: Enables capture of Node.js Environment milestones.[0m
    * [0m[33mnode.fs.sync[39m: Enables capture of trace data for file system sync methods.[0m
    * [0m[33mnode.perf[39m: Enables capture of [34mPerformance API ([34m[4mperf_hooks.html[24m[39m[34m)[39m measurements.
        * [0m[0m[33mnode.perf.usertiming[39m: Enables capture of only Performance API User Timing[0m[0m[0m
      [0m      [0m[0mmeasures and marks.[0m[0m[0m
      [0m
        * [0m[0m[33mnode.perf.timerify[39m: Enables capture of only Performance API timerify[0m[0m[0m
      [0m      [0m[0mmeasurements.[0m[0m[0m
    * [0m[33mnode.promises.rejections[39m: Enables capture of trace data tracking the number[0m
      [0mof unhandled Promise rejections and handled-after-rejections.[0m
    * [0m[33mnode.vm.script[39m: Enables capture of trace data for the [33mvm[39m module's[0m
      [0m[33mrunInNewContext()[39m, [33mrunInContext()[39m, and [33mrunInThisContext()[39m methods.[0m
    * [0m[33mv8[39m: The [34mV8 ([34m[4mv8.html[24m[39m[34m)[39m events are GC, compiling, and execution related.[0m

[0mBy default the [33mnode[39m, [33mnode.async_hooks[39m, and [33mv8[39m categories are enabled.[0m

    [33mnode --trace-event-categories v8,node,node.async_hooks server.js[39m

[0mPrior versions of Node.js required the use of the [33m--trace-events-enabled[39m[0m
[0mflag to enable trace events. This requirement has been removed. However, the[0m
[0m[33m--trace-events-enabled[39m flag [3mmay[23m still be used and will enable the[0m
[0m[33mnode[39m, [33mnode.async_hooks[39m, and [33mv8[39m trace event categories by default.[0m

    [33mnode --trace-events-enabled[39m
    [33m[39m
    [33m// is equivalent to[39m
    [33m[39m
    [33mnode --trace-event-categories v8,node,node.async_hooks[39m

[0mAlternatively, trace events may be enabled using the [33mtrace_events[39m module:[0m

    [94mconst[39m [37mtrace_events[39m [93m=[39m [37mrequire[39m[90m([39m[92m'trace_events'[39m[90m)[39m[90m;[39m
    [94mconst[39m [37mtracing[39m [93m=[39m [37mtrace_events[39m[32m.[39m[37mcreateTracing[39m[90m([39m[33m{[39m [37mcategories[39m[93m:[39m [33m[[39m[92m'node.perf'[39m[33m][39m [33m}[39m[90m)[39m[90m;[39m
    [37mtracing[39m[32m.[39m[37menable[39m[90m([39m[90m)[39m[90m;[39m  [90m// Enable trace event capture for the 'node.perf' category[39m
    
    [90m// do work[39m
    
    [37mtracing[39m[32m.[39m[37mdisable[39m[90m([39m[90m)[39m[90m;[39m  [90m// Disable trace event capture for the 'node.perf' category[39m

[0mRunning Node.js with tracing enabled will produce log files that can be opened[0m
[0min the [34m[33mchrome://tracing[39m[34m ([34m[4mhttps://www.chromium.org/developers/how-tos/trace-event-profiling-tool[24m[39m[34m)[39m[0m
[0mtab of Chrome.[0m

[0mThe logging file is by default called [33mnode_trace.${rotation}.log[39m, where[0m
[0m[33m${rotation}[39m is an incrementing log-rotation id. The filepath pattern can[0m
[0mbe specified with [33m--trace-event-file-pattern[39m that accepts a template[0m
[0mstring that supports [33m${rotation}[39m and [33m${pid}[39m:[0m

    [33mnode --trace-event-categories v8 --trace-event-file-pattern '${pid}-${rotation}.log' server.js[39m

[0mStarting with Node.js 10.0.0, the tracing system uses the same time source[0m
[0mas the one used by [33mprocess.hrtime()[39m[0m
[0mhowever the trace-event timestamps are expressed in microseconds,[0m
[0munlike [33mprocess.hrtime()[39m which returns nanoseconds.[0m

[0mThe features from this module are not available in [34m[33mWorker[39m[34m ([34m[4mworker_threads.html#worker_threads_class_worker[24m[39m[34m)[39m threads.[0m

[32m[1m## The [33mtrace_events[39m[32m module[22m[39m

[90m<!-- YAML[39m
[90madded: v10.0.0[39m
[90m-->[39m
[90m[39m
[90m[39m[32m[1m### [33mTracing[39m[32m object[22m[39m

[90m<!-- YAML[39m
[90madded: v10.0.0[39m
[90m-->[39m
[90m[39m
[90m[39m[0mThe [33mTracing[39m object is used to enable or disable tracing for sets of[0m
[0mcategories. Instances are created using the [33mtrace_events.createTracing()[39m[0m
[0mmethod.[0m

[0mWhen created, the [33mTracing[39m object is disabled. Calling the[0m
[0m[33mtracing.enable()[39m method adds the categories to the set of enabled trace event[0m
[0mcategories. Calling [33mtracing.disable()[39m will remove the categories from the[0m
[0mset of enabled trace event categories.[0m

[32m[1m#### [33mtracing.categories[39m[32m[22m[39m

[90m<!-- YAML[39m
[90madded: v10.0.0[39m
[90m-->[39m
[90m[39m
[90m[39m    * [0m{string}[0m

[0mA comma-separated list of the trace event categories covered by this[0m
[0m[33mTracing[39m object.[0m

[32m[1m#### [33mtracing.disable()[39m[32m[22m[39m

[90m<!-- YAML[39m
[90madded: v10.0.0[39m
[90m-->[39m
[90m[39m
[90m[39m[0mDisables this [33mTracing[39m object.[0m

[0mOnly trace event categories [3mnot[23m covered by other enabled [33mTracing[39m objects[0m
[0mand [3mnot[23m specified by the [33m--trace-event-categories[39m flag will be disabled.[0m

    [94mconst[39m [37mtrace_events[39m [93m=[39m [37mrequire[39m[90m([39m[92m'trace_events'[39m[90m)[39m[90m;[39m
    [94mconst[39m [37mt1[39m [93m=[39m [37mtrace_events[39m[32m.[39m[37mcreateTracing[39m[90m([39m[33m{[39m [37mcategories[39m[93m:[39m [33m[[39m[92m'node'[39m[32m,[39m [92m'v8'[39m[33m][39m [33m}[39m[90m)[39m[90m;[39m
    [94mconst[39m [37mt2[39m [93m=[39m [37mtrace_events[39m[32m.[39m[37mcreateTracing[39m[90m([39m[33m{[39m [37mcategories[39m[93m:[39m [33m[[39m[92m'node.perf'[39m[32m,[39m [92m'node'[39m[33m][39m [33m}[39m[90m)[39m[90m;[39m
    [37mt1[39m[32m.[39m[37menable[39m[90m([39m[90m)[39m[90m;[39m
    [37mt2[39m[32m.[39m[37menable[39m[90m([39m[90m)[39m[90m;[39m
    
    [90m// Prints 'node,node.perf,v8'[39m
    [34mconsole[39m[32m.[39m[34mlog[39m[90m([39m[37mtrace_events[39m[32m.[39m[37mgetEnabledCategories[39m[90m([39m[90m)[39m[90m)[39m[90m;[39m
    
    [37mt2[39m[32m.[39m[37mdisable[39m[90m([39m[90m)[39m[90m;[39m [90m// Will only disable emission of the 'node.perf' category[39m
    
    [90m// Prints 'node,v8'[39m
    [34mconsole[39m[32m.[39m[34mlog[39m[90m([39m[37mtrace_events[39m[32m.[39m[37mgetEnabledCategories[39m[90m([39m[90m)[39m[90m)[39m[90m;[39m

[32m[1m#### [33mtracing.enable()[39m[32m[22m[39m

[90m<!-- YAML[39m
[90madded: v10.0.0[39m
[90m-->[39m
[90m[39m
[90m[39m[0mEnables this [33mTracing[39m object for the set of categories covered by the[0m
[0m[33mTracing[39m object.[0m

[32m[1m#### [33mtracing.enabled[39m[32m[22m[39m

[90m<!-- YAML[39m
[90madded: v10.0.0[39m
[90m-->[39m
[90m[39m
[90m[39m    * [0m{boolean} [33mtrue[39m only if the [33mTracing[39m object has been enabled.[0m

[32m[1m### [33mtrace_events.createTracing(options)[39m[32m[22m[39m

[90m<!-- YAML[39m
[90madded: v10.0.0[39m
[90m-->[39m
[90m[39m
[90m[39m    * [0m[33moptions[39m {Object}
        * [0m[0m[33mcategories[39m {string[]} An array of trace category names. Values included[0m[0m[0m
      [0m      [0m[0min the array are coerced to a string when possible. An error will be[0m[0m[0m
      [0m      [0m[0mthrown if the value cannot be coerced.[0m[0m[0m
    * [0mReturns: {Tracing}.[0m

[0mCreates and returns a [33mTracing[39m object for the given set of [33mcategories[39m.[0m

    [94mconst[39m [37mtrace_events[39m [93m=[39m [37mrequire[39m[90m([39m[92m'trace_events'[39m[90m)[39m[90m;[39m
    [94mconst[39m [37mcategories[39m [93m=[39m [33m[[39m[92m'node.perf'[39m[32m,[39m [92m'node.async_hooks'[39m[33m][39m[90m;[39m
    [94mconst[39m [37mtracing[39m [93m=[39m [37mtrace_events[39m[32m.[39m[37mcreateTracing[39m[90m([39m[33m{[39m [37mcategories[39m [33m}[39m[90m)[39m[90m;[39m
    [37mtracing[39m[32m.[39m[37menable[39m[90m([39m[90m)[39m[90m;[39m
    [90m// do stuff[39m
    [37mtracing[39m[32m.[39m[37mdisable[39m[90m([39m[90m)[39m[90m;[39m

[32m[1m### [33mtrace_events.getEnabledCategories()[39m[32m[22m[39m

[90m<!-- YAML[39m
[90madded: v10.0.0[39m
[90m-->[39m
[90m[39m
[90m[39m    * [0mReturns: {string}[0m

[0mReturns a comma-separated list of all currently-enabled trace event[0m
[0mcategories. The current set of enabled trace event categories is determined[0m
[0mby the [3munion[23m of all currently-enabled [33mTracing[39m objects and any categories[0m
[0menabled using the [33m--trace-event-categories[39m flag.[0m

[0mGiven the file [33mtest.js[39m below, the command[0m
[0m[33mnode --trace-event-categories node.perf test.js[39m will print[0m
[0m[33m'node.async_hooks,node.perf'[39m to the console.[0m

    [94mconst[39m [37mtrace_events[39m [93m=[39m [37mrequire[39m[90m([39m[92m'trace_events'[39m[90m)[39m[90m;[39m
    [94mconst[39m [37mt1[39m [93m=[39m [37mtrace_events[39m[32m.[39m[37mcreateTracing[39m[90m([39m[33m{[39m [37mcategories[39m[93m:[39m [33m[[39m[92m'node.async_hooks'[39m[33m][39m [33m}[39m[90m)[39m[90m;[39m
    [94mconst[39m [37mt2[39m [93m=[39m [37mtrace_events[39m[32m.[39m[37mcreateTracing[39m[90m([39m[33m{[39m [37mcategories[39m[93m:[39m [33m[[39m[92m'node.perf'[39m[33m][39m [33m}[39m[90m)[39m[90m;[39m
    [94mconst[39m [37mt3[39m [93m=[39m [37mtrace_events[39m[32m.[39m[37mcreateTracing[39m[90m([39m[33m{[39m [37mcategories[39m[93m:[39m [33m[[39m[92m'v8'[39m[33m][39m [33m}[39m[90m)[39m[90m;[39m
    
    [37mt1[39m[32m.[39m[37menable[39m[90m([39m[90m)[39m[90m;[39m
    [37mt2[39m[32m.[39m[37menable[39m[90m([39m[90m)[39m[90m;[39m
    
    [34mconsole[39m[32m.[39m[34mlog[39m[90m([39m[37mtrace_events[39m[32m.[39m[37mgetEnabledCategories[39m[90m([39m[90m)[39m[90m)[39m[90m;[39m

